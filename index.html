<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journey of Steps: Evolving Fractal Web & Particle Trails</title>
  <style>
    /* Basic reset and full-screen setup */
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #101010;
      font-family: sans-serif;
      color: #fff;
    }
    /* Two canvases layered on top of each other */
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #particleCanvas {
      z-index: 1;
    }
    #webCanvas {
      z-index: 2;
      pointer-events: none;
    }
    /* Overlay content for journey steps */
    #content {
      position: absolute;
      z-index: 3;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      background: rgba(0, 0, 0, 0.5);
      padding: 20px 30px;
      border-radius: 10px;
      max-width: 80%;
    }
    #content h1 {
      margin: 0 0 10px;
      font-size: 2em;
    }
    #content p {
      margin: 0 0 20px;
      font-size: 1.2em;
    }
    #nextBtn {
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #1e90ff;
      color: #fff;
    }
    #nextBtn:hover {
      background-color: #3aa0ff;
    }
  </style>
</head>
<body>
  <!-- Canvas for particle trails -->
  <canvas id="particleCanvas"></canvas>
  <!-- Canvas for the fractal web -->
  <canvas id="webCanvas"></canvas>
  <!-- Overlay content for the journey steps -->
  <div id="content">
    <h1 id="stepTitle"></h1>
    <p id="stepDescription"></p>
    <button id="nextBtn">Next Step</button>
  </div>

  <script>
    /***********************
     * Canvas Setup & Resize
     ***********************/
    const particleCanvas = document.getElementById('particleCanvas');
    const particleCtx = particleCanvas.getContext('2d');
    const webCanvas = document.getElementById('webCanvas');
    const webCtx = webCanvas.getContext('2d');

    function resizeCanvases() {
      particleCanvas.width = window.innerWidth;
      particleCanvas.height = window.innerHeight;
      webCanvas.width = window.innerWidth;
      webCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvases);
    resizeCanvases();

    /***********************
     * Step Configurations
     ***********************/
    // Each step has its own journey text and configuration parameters.
    const steps = [
      {
        title: "Step 1: The Beginning",
        description: "Embark on your journey. The fractal web and gentle particles mark the start of your path.",
        fractal: { depth: 4, numPoints: 8, angleSpeed: 0.02, initialRadiusFactor: 0.45 },
        particles: { speedMultiplier: 0.8, count: 60 }
      },
      {
        title: "Step 2: The Journey",
        description: "Progress along winding paths. The fractal web expands and particles pick up momentum.",
        fractal: { depth: 5, numPoints: 8, angleSpeed: 0.01, initialRadiusFactor: 0.5 },
        particles: { speedMultiplier: 1.0, count: 80 }
      },
      {
        title: "Step 3: The Arrival",
        description: "Arrive at your destination. The fractal web calms and particles drift softly, marking a serene end.",
        fractal: { depth: 3, numPoints: 6, angleSpeed: 0.005, initialRadiusFactor: 0.4 },
        particles: { speedMultiplier: 0.5, count: 40 }
      }
    ];
    let currentStepIndex = 0;
    let currentConfig = steps[currentStepIndex];

    // Update the overlay content based on the current step.
    const stepTitleEl = document.getElementById('stepTitle');
    const stepDescriptionEl = document.getElementById('stepDescription');
    function updateStepContent() {
      stepTitleEl.textContent = currentConfig.title;
      stepDescriptionEl.textContent = currentConfig.description;
    }
    updateStepContent();

    // Handle "Next Step" button clicks.
    document.getElementById('nextBtn').addEventListener('click', () => {
      currentStepIndex = (currentStepIndex + 1) % steps.length;
      currentConfig = steps[currentStepIndex];
      updateStepContent();
      // Reinitialize particles with the new configuration.
      initParticles();
    });

    /***********************
     * Particle System (with Trails)
     ***********************/
    class Particle {
      constructor(x, y, speedMultiplier) {
        this.x = x;
        this.y = y;
        // Slow, gentle velocities based on the speed multiplier.
        this.vx = (Math.random() - 0.5) * speedMultiplier;
        this.vy = (Math.random() - 0.5) * speedMultiplier;
        this.radius = Math.random() * 2 + 1;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        // Wrap around edges to keep particles always on screen.
        if (this.x < 0) this.x += particleCanvas.width;
        if (this.x > particleCanvas.width) this.x -= particleCanvas.width;
        if (this.y < 0) this.y += particleCanvas.height;
        if (this.y > particleCanvas.height) this.y -= particleCanvas.height;
      }
      draw(ctx) {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.fill();
      }
    }

    let particles = [];
    function initParticles() {
      particles = [];
      const count = currentConfig.particles.count;
      for (let i = 0; i < count; i++) {
        particles.push(new Particle(
          Math.random() * particleCanvas.width,
          Math.random() * particleCanvas.height,
          currentConfig.particles.speedMultiplier
        ));
      }
    }
    initParticles();

    /***********************
     * Fractal Web Drawing
     ***********************/
    /**
     * Recursively draws an interweaving fractal web.
     *
     * @param {CanvasRenderingContext2D} ctx - The drawing context.
     * @param {number} x - Center x-coordinate.
     * @param {number} y - Center y-coordinate.
     * @param {number} radius - Current radius.
     * @param {number} depth - Recursion depth.
     * @param {number} angleOffset - Rotation offset in radians.
     */
    function drawFractalWeb(ctx, x, y, radius, depth, angleOffset) {
      if (depth <= 0 || radius < 2) return;
      const numPoints = currentConfig.fractal.numPoints;
      const points = [];

      // Compute points around a circle.
      for (let i = 0; i < numPoints; i++) {
        const angle = angleOffset + i * (2 * Math.PI / numPoints);
        const px = x + radius * Math.cos(angle);
        const py = y + radius * Math.sin(angle);
        points.push({ x: px, y: py });
      }

      // Draw lines connecting every pair of points.
      ctx.strokeStyle = `rgba(100, 180, 255, ${0.7 * depth / 4})`;
      ctx.lineWidth = depth;
      ctx.beginPath();
      for (let i = 0; i < numPoints; i++) {
        for (let j = i + 1; j < numPoints; j++) {
          ctx.moveTo(points[i].x, points[i].y);
          ctx.lineTo(points[j].x, points[j].y);
        }
      }
      ctx.stroke();

      // Recursively draw the web from each point.
      for (let i = 0; i < numPoints; i++) {
        drawFractalWeb(ctx, points[i].x, points[i].y, radius * 0.5, depth - 1, angleOffset + currentConfig.fractal.angleSpeed);
      }
    }

    /***********************
     * Animation Loop
     ***********************/
    let time = 0;
    function animate() {
      time += 0.002; // Evolve very slowly

      // --- Particle Trails ---
      // Draw a translucent overlay to slowly fade previous particle positions.
      particleCtx.fillStyle = "rgba(16, 16, 16, 0.05)";
      particleCtx.fillRect(0, 0, particleCanvas.width, particleCanvas.height);
      particles.forEach(particle => {
        particle.update();
        particle.draw(particleCtx);
      });

      // --- Fractal Web ---
      // Clear and redraw the fractal web.
      webCtx.clearRect(0, 0, webCanvas.width, webCanvas.height);
      const centerX = webCanvas.width / 2;
      const centerY = webCanvas.height / 2;
      const initialRadius = Math.min(webCanvas.width, webCanvas.height) * currentConfig.fractal.initialRadiusFactor;
      const depth = currentConfig.fractal.depth;
      const angleOffset = time;
      drawFractalWeb(webCtx, centerX, centerY, initialRadius, depth, angleOffset);

      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
